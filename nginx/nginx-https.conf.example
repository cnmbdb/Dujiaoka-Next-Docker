# ============================================================================
# Dujiao-Next Nginx HTTPS 反向代理配置示例
# ============================================================================
# 使用方法：
# 1. 复制此文件为 nginx.conf 或放入 /etc/nginx/conf.d/
# 2. 替换 your-domain.com 为你的域名
# 3. 使用 Certbot 获取 SSL 证书: certbot --nginx -d www.xxx.com -d api.xxx.com -d admin.xxx.com
# ============================================================================

# User 用户前台 - https://www.your-domain.com
server {
    listen 80;
    server_name www.your-domain.com;
    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# API 服务 - https://api.your-domain.com
server {
    listen 80;
    server_name api.your-domain.com;
    location / {
        proxy_pass http://127.0.0.1:3001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
}

# Admin 后台 - https://admin.your-domain.com
server {
    listen 80;
    server_name admin.your-domain.com;
    location / {
        proxy_pass http://127.0.0.1:3002;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# Certbot 会自动添加 443 端口的 SSL 配置
# 或手动配置 SSL 示例：
#
# server {
#     listen 443 ssl http2;
#     server_name www.your-domain.com;
#     ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
#     ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;
#     location / {
#         proxy_pass http://127.0.0.1:3000;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto https;
#     }
# }
