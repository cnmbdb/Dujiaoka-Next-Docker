# 初始化说明

## 存储卷配置

根据官方文档，使用 **bind mount**（本地目录挂载）而非命名卷：

- `./data/postgres` - PostgreSQL 数据
- `./data/redis` - Redis 数据  
- `./data/uploads` - 上传文件
- `./data/logs` - API 日志

**首次部署前需要创建目录并设置权限**：

```bash
mkdir -p data/{postgres,redis,uploads,logs}
chmod -R 777 data/logs data/uploads  # API 容器可能非 root 用户
```

---

## 后台登录问题排查

### 1. 检查管理员是否已创建

```bash
# 查看 API 日志
docker compose logs api | grep -i "admin\|初始化\|default"

# 进入数据库查看
docker compose exec dujiao-postgres psql -U dujiao_user -d dujiao_db -c "SELECT username FROM admins;"
```

### 2. 重新初始化管理员

如果管理员未创建，可以：

**方法1：删除数据库重新初始化**
```bash
docker compose down
rm -rf data/postgres/*
docker compose up -d
```

**方法2：手动创建管理员**
```bash
# 进入 API 容器
docker compose exec api sh

# 使用 API 创建管理员（如果有相关命令）
# 或直接操作数据库
```

### 3. 检查环境变量

确保 `.env` 中有：
```bash
DJ_DEFAULT_ADMIN_USERNAME=admin
DJ_DEFAULT_ADMIN_PASSWORD=admin123
```

### 4. 检查 API 服务状态

```bash
# 查看 API 是否正常运行
docker compose ps api

# 查看 API 日志
docker compose logs -f api
```

---

## 默认登录信息

- **账号**: `admin`
- **密码**: `admin123`

（首次启动时自动创建，如果数据库已存在管理员则不会创建）
